
<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Masanja AI</title>

<style>
*{box-sizing:border-box;font-family:system-ui,Arial}
body{
  margin:0;min-height:100vh;
  background:linear-gradient(135deg,#0f5b3e,#06251c);
  display:flex;align-items:center;justify-content:center;
  color:#fff
}
.app{width:100%;max-width:460px;padding:20px;text-align:center}
h1{margin:6px 0}
.sub{font-size:14px;opacity:.85;margin-bottom:12px}
.output{
  background:#fff;color:#000;border-radius:12px;
  padding:15px;min-height:230px;
  text-align:left;white-space:pre-line;margin-bottom:16px
}
.mic{
  width:90px;height:90px;border-radius:50%;
  border:none;font-size:32px;cursor:pointer;background:#2ecc71
}
.mic:active{transform:scale(.95);background:#27ae60}
</style>
</head>

<body>
<div class="app">
  <h1>Masanja AI</h1>
  <div class="sub">Msaidizi wa Ufundi â€” Kiswahili (Kenya)</div>

  <div id="out" class="output">
Karibu Masanja AI.  
Bonyeza ğŸ¤ uongee nami.
  </div>

  <button id="mic" class="mic">ğŸ¤</button>
</div>

<script>
/* =================================================
   KNOWLEDGE BASE â€” MAJIBU YA KIUFUNDI (MENGI)
================================================= */
const DATA = [
  // GENERAL
  {k:["vipi","mambo","niaje","ukoje","poa"],a:"Poa kabisa. Eleza tatizo la ufundi lilivyo."},
  {k:["nisaidie","msaada","help"],a:"Sawa. Nipe dalili zote."},
  {k:["wewe ni nani","jina lako"],a:"Mimi ni Masanja AI, msaidizi wa masuala ya ufundi."},

  // HYDRAULIC
  {k:["hydraulic","haina nguvu","pressure ndogo"],a:"Hydraulic ikikosa nguvu, kagua kiwango cha mafuta, pump, pressure relief valve, na filters."},
  {k:["hydraulic","inachemka","joto","overheat"],a:"Hydraulic ikipata joto, angalia oil cooler, airflow, fan, na aina ya mafuta."},
  {k:["hydraulic","kelele","inavuma","cavitation"],a:"Kelele kwenye hydraulic huonyesha hewa kwenye mfumo, suction imeziba, au pump imechoka."},
  {k:["hydraulic","inavuja","leak"],a:"Uvujaji wa hydraulic hutokana na hose, fittings, seals au O-rings kuharibika."},

  // ENGINE
  {k:["engine","injini","haiwaki","haianzi"],a:"Injini isipoanza, kagua betri, starter, relay, fuel supply na air filter."},
  {k:["engine","inachemka","joto"],a:"Joto la injini husababishwa na coolant pungufu, radiator chafu, thermostat au fan mbovu."},
  {k:["engine","moshi mweusi"],a:"Moshi mweusi unaonyesha mafuta mengi au air filter imeziba."},
  {k:["engine","moshi mweupe"],a:"Moshi mweupe unaweza kuonyesha maji kuingia kwenye combustion."},

  // ELECTRICAL
  {k:["umeme","taa hazifanyi"],a:"Tatizo la umeme linaweza kutokana na fuse kuchoma, wiring kuharibika au ground mbovu."},
  {k:["battery","betri imekufa"],a:"Betri ikikufa, pima voltage na kagua terminals na alternator."},
  {k:["alternator","haichaji"],a:"Alternator isipochaji, kagua belt, wiring na alternator yenyewe."},

  // TRANSMISSION
  {k:["gear","transmission","haibadilishi"],a:"Tatizo la kubadilisha gear hutokana na mafuta pungufu au solenoids mbovu."},

/* =======================
   BLOCK KUBWA â€“ MAZUNGUMZO YA KAWAIDA
======================= */
{
  k:["habari za kazi","kazi zinaendaje"],
  a:"Kazi zinaendelea. Eleza changamoto uliyonayo sasa."
},
{
  k:["leo nimechoka sana"],
  a:"Pole sana. Ufundi unahitaji uvumilivu, pumzika kidogo halafu tuendelee."
},
{
  k:["niko kazini site"],
  a:"Sawa. Hakikisha usalama kwanza kabla ya kuendelea na kazi."
},
{
  k:["niko gereji"],
  a:"Vizuri. Gereji ndiyo mahali sahihi pa kufanya uchunguzi wa kina."
},
{
  k:["nataka kujifunza zaidi"],
  a:"Hilo ni jambo jema. Kujifunza ufundi ni mchakato wa kila siku."
},

/* =======================
   BLOCK KUBWA â€“ HYDRAULIC
======================= */
{
  k:["hydraulic","boom","inashuka haraka"],
  a:"Boom ikishuka haraka, check flow control valve au cylinder seals zimechoka."
},
{
  k:["hydraulic","boom","inashindwa kushika mzigo"],
  a:"Hii huashiria pressure ndogo au valve inavuja internally."
},
{
  k:["hydraulic","arm","inatetemeka kazini"],
  a:"Arm ikitetemeka, kuna hewa kwenye mfumo au pump haifanyi kazi sawasawa."
},
{
  k:["hydraulic","bucket","inachelewa kufunga"],
  a:"Bucket ikichelewa, spool valve inaweza kuwa chafu au mafuta ni mazito."
},
{
  k:["hydraulic","oil","inapata povu"],
  a:"Mafuta yakipata povu, kuna hewa inaingia kwenye mfumo wa suction."
},
{
  k:["hydraulic","pressure","inapanda kushuka"],
  a:"Pressure isiyo stable huashiria relief valve au pump ina matatizo."
},
{
  k:["hydraulic","hose","inapasuka mara kwa mara"],
  a:"Hose kupasuka mara kwa mara huonyesha pressure kubwa au hose siyo sahihi."
},
{
  k:["hydraulic","filter","inaziba haraka"],
  a:"Filter ikiziba haraka, system ina uchafu mwingi au mafuta ni machafu."
},

/* =======================
   BLOCK KUBWA â€“ ENGINE
======================= */
{
  k:["engine","inazima nikiweka mzigo"],
  a:"Injini ikizima ukiweka mzigo, fuel supply au air flow inaweza kuwa shida."
},
{
  k:["engine","inatetemeka kazini"],
  a:"Kutetemeka huashiria injector moja haifanyi kazi vizuri."
},
{
  k:["engine","power inapungua mchana"],
  a:"Power ikipungua mchana, engine inapata joto au fuel quality ni mbaya."
},
{
  k:["engine","inatema mafuta"],
  a:"Injini ikitupa mafuta, crankcase pressure inaweza kuwa kubwa."
},
{
  k:["engine","oil pressure inapotea"],
  a:"Kupotea kwa oil pressure ni hatari, zima injini na kagua oil pump."
},
{
  k:["engine","moshi mweusi mwingi"],
  a:"Moshi mweusi mwingi huonyesha mafuta mengi au air intake imeziba."
},
{
  k:["engine","moshi wa bluu"],
  a:"Moshi wa bluu unaonyesha mafuta yanaingia kwenye combustion chamber."
},
{
  k:["engine","starter inachelewa"],
  a:"Starter kuchelewa huashiria betri dhaifu au starter imechoka."
},

/* =======================
   BLOCK KUBWA â€“ UMEME
======================= */
{
  k:["umeme","hakuna power kabisa"],
  a:"Hakuna power kabisa, kagua main switch, fuse kuu na betri."
},
{
  k:["umeme","machine inazima ghafla"],
  a:"Kuzima ghafla huashiria loose connection au sensor mbovu."
},
{
  k:["umeme","voltage inapanda kushuka"],
  a:"Voltage isiyo stable huonyesha alternator au regulator ina shida."
},
{
  k:["umeme","taa zinapungua mwanga"],
  a:"Taa kupungua mwanga huashiria betri au alternator haifanyi kazi vizuri."
},
{
  k:["umeme","starter relay inachemka"],
  a:"Relay ikipata joto, kuna overload au short circuit."
},
{
  k:["umeme","wiring inanuka moto"],
  a:"Harufu ya moto kwenye wiring ni hatari, zima mashine mara moja."
},

/* =======================
   BLOCK KUBWA â€“ TRANSMISSION & DRIVE
======================= */
{
  k:["gear","inapiga kelele kubadilisha"],
  a:"Kelele wakati wa kubadilisha gear huonyesha clutch au gear zimechoka."
},
{
  k:["gear","inachelewa kuingia forward"],
  a:"Kuchelewa kuingia forward huashiria mafuta pungufu kwenye transmission."
},
{
  k:["transmission","inapata joto"],
  a:"Transmission ikipata joto, angalia oil level na oil cooler."
},
{
  k:["final drive","inavuja mafuta"],
  a:"Uvujaji kwenye final drive huonyesha seal kuharibika."
},
{
  k:["differential","inatoa kelele"],
  a:"Kelele kwenye differential huonyesha gear au bearing zimechoka."
}


/* =======================
   BLOCK JINGINE â€“ OPERETA & KAZI SITE
======================= */
{
  k:["niko site","kazi site"],
  a:"Sawa. Hakikisha usalama kwanza, vaa PPE kabla ya kuendelea."
},
{
  k:["mashine iko kazini muda mrefu"],
  a:"Mashine ikifanya kazi muda mrefu, hakikisha inapumzishwa na mafuta yakaguliwe."
},
{
  k:["mashine mpya"],
  a:"Mashine mpya inahitaji break-in period, usiibebeshe mzigo mkubwa mapema."
},
{
  k:["operator anachoka"],
  a:"Operator akichoka, hatari ya ajali inaongezeka. Pumzika kabla ya kuendelea."
},

/* =======================
   BLOCK JINGINE â€“ HYDRAULIC (ADVANCED)
======================= */
{
  k:["hydraulic","pressure inapotea ghafla"],
  a:"Pressure ikipotea ghafla, relief valve inaweza kuwa stuck open au pump imeharibika."
},
{
  k:["hydraulic","oil inarudi tank"],
  a:"Oil kurudi tank bila kufanya kazi huashiria internal leakage kwenye valve."
},
{
  k:["hydraulic","control lever ngumu"],
  a:"Lever ikiwa ngumu, linkage imekauka au valve imechafuka."
},
{
  k:["hydraulic","cylinder inasukuma lakini hairudi"],
  a:"Cylinder ikisukuma bila kurudi, return line imeziba au valve imekwama."
},
{
  k:["hydraulic","hose inatetemeka"],
  a:"Hose ikitetemeka, pressure fluctuation ipo au hose haijafungwa vizuri."
},
{
  k:["hydraulic","oil inanuka"],
  a:"Harufu kali ya mafuta huonyesha overheating au mafuta yameharibika."
},

/* =======================
   BLOCK JINGINE â€“ ENGINE (ADVANCED)
======================= */
{
  k:["engine","inawaka kwa shida asubuhi"],
  a:"Kuwaka kwa shida asubuhi huashiria glow plugs au compression kuwa chini."
},
{
  k:["engine","inatema moshi asubuhi"],
  a:"Moshi asubuhi unaweza kuwa kawaida, lakini ukizidi ni dalili ya injector au rings."
},
{
  k:["engine","inapiga backfire"],
  a:"Backfire huashiria timing mbaya au valve problems."
},
{
  k:["engine","fuel consumption kubwa"],
  a:"Matumizi makubwa ya mafuta huashiria injector, air filter au driving style."
},
{
  k:["engine","rpm hazitulii"],
  a:"RPM zisizotulia huashiria sensor, governor au air leak."
},
{
  k:["engine","check engine light"],
  a:"Check engine ikiwaka, soma error code kabla ya kuendelea na kazi."
},

/* =======================
   BLOCK JINGINE â€“ UMEME (ADVANCED)
======================= */
{
  k:["umeme","short circuit"],
  a:"Short circuit ni hatari. Zima power mara moja na kagua wiring."
},
{
  k:["umeme","fuse inachoma mara kwa mara"],
  a:"Fuse kuchoma mara kwa mara huonyesha overload au short circuit."
},
{
  k:["umeme","sensor inasoma vibaya"],
  a:"Sensor ikisoma vibaya, kagua connector au badilisha sensor."
},
{
  k:["umeme","machine inajiwasha yenyewe"],
  a:"Hii huonyesha wiring problem au relay stuck."
},
{
  k:["umeme","ground mbaya"],
  a:"Ground mbaya husababisha matatizo mengi ya umeme, kagua earth connections."
},

/* =======================
   BLOCK JINGINE â€“ USALAMA
======================= */
{
  k:["usalama","safety","ajali"],
  a:"Usalama ni muhimu. Hakikisha mashine imezimwa kabla ya matengenezo."
},
{
  k:["usalama","hydraulic hose kupasuka"],
  a:"Hose ikipasuka, mafuta yanaweza kujeruhi. Simama mbali na mashine."
},
{
  k:["usalama","umeme hatari"],
  a:"Kabla ya kugusa umeme, zima main switch na toa key."
},
{
  k:["usalama","fire","moto"],
  a:"Moto ukitokea, tumia fire extinguisher sahihi na zima mashine."
}
  
  // FALLBACK
  {k:["*"],a:"Nimekuelewa kwa ujumla. Tafadhali eleza zaidi dalili na mfumo unaohusika."}
];

function getAnswer(t){
  t=t.toLowerCase();
  let best=null,score=0;
  for(const d of DATA){
    if(d.k.includes("*")) continue;
    let s=0;
    for(const w of d.k){ if(t.includes(w)) s++; }
    if(s>score){ score=s; best=d.a; }
  }
  return best || DATA.find(d=>d.k.includes("*")).a;
}

/* =================================================
   SAUTI â€” MOJA TU, YA KIUME, IMEFUNGWA MWANZO
================================================= */
let FIXED_VOICE = null;

// chagua voice mara MOJA tu
function initFixedVoice(){
  const voices = speechSynthesis.getVoices();
  if(!voices || voices.length === 0) return;

  // jaribu sw-KE
  FIXED_VOICE = voices.find(v => v.lang && v.lang.toLowerCase().includes("sw-ke"));

  // fallback: sw yoyote
  if(!FIXED_VOICE){
    FIXED_VOICE = voices.find(v => v.lang && v.lang.toLowerCase().startsWith("sw"));
  }

  // mwisho: voice ya kwanza tu
  if(!FIXED_VOICE){
    FIXED_VOICE = voices[0];
  }

  // zima kubadilika tena
  speechSynthesis.onvoiceschanged = null;
}

speechSynthesis.onvoiceschanged = initFixedVoice;

function speak(text){
  if(!FIXED_VOICE) initFixedVoice();
  const u = new SpeechSynthesisUtterance(text);
  u.voice = FIXED_VOICE;
  u.lang = "sw-KE";
  u.rate = 0.9;
  u.pitch = 0.95;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* =================================================
   SPEECH RECOGNITION
================================================= */
const out=document.getElementById("out");
const mic=document.getElementById("mic");
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
const rec=SR?new SR():null;

if(rec){
  rec.lang="sw-KE";
  rec.interimResults=false;
  rec.continuous=false;
}

mic.onclick=()=>{
  if(!rec){
    out.innerText="Browser yako haiungi mkono sauti.";
    return;
  }
  out.innerText="ğŸ§ Ninasikiliza...";
  rec.start();
};

if(rec){
  rec.onresult=e=>{
    const t=e.results[0][0].transcript;
    const a=getAnswer(t);
    out.innerText="ğŸ—£ï¸ Umesema:\n"+t+"\n\nğŸ¤– Masanja AI:\n"+a;
    speak(a);
  };
}
</script>
</body>
</html>
